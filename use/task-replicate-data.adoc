---
sidebar: sidebar 
permalink: use/task-replicate-data.html 
keywords: amazon fsx for netapp ontap, fsx, manage fsx for ontap system, delete fsx for ontap system, remove fsx for ontap system, throughput capacity, change throughput, automatic capacity management, capacity management, storage capacity, replication, classification, sync, backup, recovery, bluexp, NetApp Console 
summary: NetApp Consoleで FSx for ONTAPシステムを作成または検出すると、ファイルシステムを管理し、バックアップやリカバリなどの機能を提供するNetAppデータ サービスを使用できるようになります。 
---
= NetApp ConsoleでFSx for ONTAPにデータを複製
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
データが保存されている地域で災害が発生した場合に、データの損失を防ぐためにデータを複製します。データレプリケーションは、Amazon FSx for NetApp ONTAPファイルシステムとオンプレミスONTAPシステムまたはCloud Volumes ONTAP間でサポートされています。

ストレージ VM の移行では、レプリケーション関係を作成した直後にカットオーバー操作を完了する必要があります。



== タスク概要

レプリケーションは、地域災害からデータを保護し、ストレージ VM の移行をサポートします。

ターゲット ファイル システム内の複製されたボリュームはデータ保護（DP）ボリュームであり、次の命名形式に従います： `{OriginalVolumeName}_copy`

不変のファイルを含むソース ボリュームを複製する場合、ターゲット ボリュームとファイル システムは、ソース ボリュームの保持期間が終了するまでロックされたままになります。不変ファイル機能は、FSx for ONTAP ファイルシステムのlink:https://docs.netapp.com/us-en/workload-fsx-ontap/create-volume.html["ボリュームを作成する"]ときに使用できます。

[NOTE]
====
* iSCSI または NVMe プロトコルを使用するブロック ボリュームでは、レプリケーションはサポートされていません。
* 1つのソース（読み取り / 書き込み）ボリュームまたは1つのデータ保護（DP）ボリュームを複製できます。カスケードレプリケーションはサポートされていますが、3番目のホップはサポートされていません。link:https://review.docs.netapp.com/us-en/workload-fsx-ontap_cascade-replication/cascade-replication.html["カスケードレプリケーション"^]の詳細をご覧ください。


====


=== 移行のユースケース

移行ユースケースを選択する場合、オプションで、単一のストレージVMのストレージVMデータと構成設定を複製することを選択できます。データと構成設定を同時に移行する場合は、ボリュームの最後のレプリケーションが過去24時間以内に完了していることを確認してください。この機能を使用するには、同じストレージVM内のすべてのボリュームを選択する必要があります。すべてのボリュームの階層化ポリシーは、移行ユースケースに推奨されるソースボリュームの階層化ポリシーにデフォルト設定されます。

Workload Factory は、次のストレージシステム間の移行レプリケーションをサポートしています。

* オンプレミスONTAPシステムとFSx for ONTAPファイルシステム
* Cloud Volumes ONTAP および FSx for ONTAP ファイルシステム
* FSx for ONTAPおよびFSx for ONTAPファイルシステム
+
** 第 1 世代から第 1 世代
** 第 1 世代から第 2 世代
** 第2世代から第2世代




ストレージ VM データと構成設定を移行するには、2 つの操作を完了する必要があります。

. <<レプリケーション関係の作成,レプリケーション関係の作成>>、ユースケースとして*Migration*を選択し、*Replicate storage VM configuration*を選択します。
. <<移行ユースケースのカットオーバーレプリケーション,移行ユースケースのカットオーバーレプリケーション>>ソースファイルシステムからターゲットのFSx for ONTAPファイルシステムにデータと構成設定を永続的に移行します。


この機能を使用するには、



== レプリケーション関係の作成

2つのFSx for ONTAPファイルシステム間、オンプレミスONTAPシステムとFSx for ONTAPファイルシステム間、またはCloud Volumes ONTAPとFSx for ONTAPファイルシステム間でデータを複製します。

.開始する前に
開始する前に、これらの要件を確認してください。

* FSx for ONTAP とオンプレミス ONTAP または Cloud Volumes ONTAP 間でデータをレプリケートするには、ファイルシステムへのリンクを関連付ける必要があります。link:https://docs.netapp.com/us-en/workload-fsx-ontap/create-link.html["既存のリンクを関連付ける方法、または新しいリンクを作成して関連付ける方法を学びます"]。リンクを関連付けた後、この操作に戻ってください。
* オンプレミス ONTAP システムから FSx for ONTAP ファイルシステムへのレプリケーションの場合は、オンプレミス ONTAP システムが検出されていることを確認してください。
* 使用可能、作成済み、または構成ミス以外の状態のボリュームではレプリケーションはサポートされません。また、ONTAP バージョンに互換性がない場合もサポートされません。
* 移行のユースケースでは、ストレージ VM のデータおよび設定とのレプリケーション関係を作成する前に、ボリュームの最後のレプリケーションが過去 24 時間以内に完了していることを確認してください。


.手順
. NetApp Console の Systems ページから、ソース FSx for ONTAP ファイル システム、オンプレミス ONTAP システム、または Cloud Volumes ONTAP システムをターゲット FSx for ONTAP ファイル システムの上にドラッグし、*レプリケーション*を選択します。
. レプリケーションの作成ページで、レプリケートするソースボリュームを選択し、[次へ] をクリックします。
. レプリケーション ターゲットで、次の内容を入力します。
+
.. *ターゲット名*：ソース ストレージ システムをコンソール システム ページのターゲット システムにドラッグアンドドロップしたときに適用したターゲット名。
.. *使用ケース*: レプリケーションの次の使用ケースのいずれかを選択します。選択したユースケースに応じて、Workload Factory はベストプラクティスに従って推奨値をフォームに入力します。フォームに入力する際に、推奨値を受け入れることも、変更することもできます。
+
*** 移行: データをターゲットの FSx for ONTAPファイルシステムに転送します
+
* ストレージ VM 構成のレプリケート * ：オプションで、単一のストレージ VM のストレージ VM データと構成設定をレプリケートするように選択します。データと構成設定を同時に移行する場合は、ボリュームの最後のレプリケーションが過去 24 時間以内に完了していることを確認してください。この機能を使用するには、同じストレージ VM 内のすべてのボリュームを選択する必要があります。すべてのボリュームの階層化ポリシーは、移行のユースケースに推奨されるソースボリュームの階層化ポリシーにデフォルト設定されます。

*** ホット災害復旧: 重要なワークロードの高可用性と迅速な災害復旧を保証します
*** コールドまたはアーカイブ災害復旧:
+
**** コールド災害復旧: より長い復旧時間目標 (RTO) と復旧ポイント目標 (RPO) を使用してコストを削減します。
**** アーカイブ: 長期保存とコンプライアンスのためにデータを複製します


*** その他
+
さらに、ユースケースの選択によって、レプリケーション ポリシー、またはSnapMirrorポリシー (ONTAP) が決まります。レプリケーションポリシーを説明するために使用される用語は、link:https://docs.netapp.com/us-en/ontap/data-protection/default-protection-policies-concept.html["ONTAP 9 ドキュメント"^] 。

+
**** 移行などの場合、レプリケーション ポリシーは _MirrorAllSnapshots_ と呼ばれます。  _MirrorAllSnapshots_ は、すべてのスナップショットと最新のアクティブなファイルシステムをミラーリングするための非同期ポリシーです。
**** ホット、コールド、またはアーカイブの災害復旧の場合、レプリケーション ポリシーは _MirrorAndVault_ と呼ばれます。  _MirrorAndVault_ は、最新のアクティブなファイル システムと毎日および毎週のスナップショットをミラーリングするための非同期およびボールト ポリシーです。
+
すべてのユースケースにおいて、長期保存用にスナップショットを有効にすると、デフォルトのレプリケーション ポリシーは _MirrorAndVault_ になります。





.. *FSx for ONTAP ファイル システム*：ターゲット FSx for ONTAP ファイル システムのクレデンシャル、リージョン、および FSx for ONTAP ファイル システム名を選択します。
.. *ストレージ VM 名*: ドロップダウン メニューからストレージ VM を選択します。選択したストレージ VM は、このレプリケーション関係で選択されたすべてのボリュームのターゲットになります。
.. *ボリューム名*: ターゲットボリューム名は次の形式で自動的に生成されます `{OriginalVolumeName}_copy`。自動生成されたボリューム名を使用することも、別のボリューム名を入力することもできます。
.. *階層化ポリシー*: ターゲット ボリュームに保存されているデータの階層化ポリシーを選択します。階層化ポリシーは、選択したユースケースに推奨される階層化ポリシーにデフォルト設定されます。
+
_バランス (自動)_ は、Workload Factory コンソールを使用してボリュームを作成するときのデフォルトの階層化ポリシーです。ボリューム階層化ポリシーの詳細については、以下を参照してください。link:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/volume-storage-capacity.html#data-tiering-policy["ボリュームストレージ容量"^] AWS FSx for NetApp ONTAPドキュメント。ワークロード ファクトリーは、ワークロード ファクトリー コンソールで階層化ポリシーにユースケース ベースの名前を使用し、括弧内に FSx for ONTAP階層化ポリシー名を含めることに注意してください。

+
移行ユースケースを選択した場合、Workload Factory はソース ボリュームの階層化ポリシーをターゲット ボリュームにコピーすることを自動的に選択します。階層化ポリシーのコピーの選択を解除し、レプリケーション対象として選択したボリュームに適用する階層化ポリシーを選択できます。

.. *最大転送速度*: *制限* を選択し、最大転送制限を MB/秒単位で入力します。または、「*無制限*」を選択します。
+
制限がないと、ネットワークとアプリケーションのパフォーマンスが低下する可能性があります。あるいは、災害復旧を主目的として使用するような重要なワークロードの場合、FSx for ONTAPファイル システムに無制限の転送速度を使用することをお勧めします。



. レプリケーション設定で、次の内容を入力します。
+
.. *レプリケーション間隔*: スナップショットがソース ボリュームからターゲット ボリュームに転送される頻度を選択します。
.. *長期保存*: 必要に応じて、長期保存用のスナップショットを有効にします。長期保存により、サイト全体の障害が発生した場合でもビジネス サービスは継続して実行でき、セカンダリ コピーを使用してアプリケーションを透過的にフェールオーバーできます。
+
長期保存のないレプリケーションでは、_MirrorAllSnapshots_ ポリシーが使用されます。長期保存を有効にすると、レプリケーションに _MirrorAndVault_ ポリシーが割り当てられます。

+
長期保存を有効にする場合は、既存のポリシーを選択するか、新しいポリシーを作成して、複製するスナップショットと保持する数を定義します。

+

NOTE: 長期保存には、ソース ラベルとターゲット ラベルの一致が必要です。必要に応じて、ワークロード ファクトリーで不足しているラベルを作成できます。

+
*** *既存のポリシーを選択*: ドロップダウン メニューから既存のポリシーを選択します。
*** *新しいポリシーを作成*：*ポリシー名*を入力します。


.. *不変のスナップショット*: オプション。このポリシーで作成されたスナップショットが保持期間中に削除されないようにするには、「*不変スナップショットを有効にする*」を選択します。
+
*** *保存期間*を時間、日、月、または年数で設定します。
*** *スナップショット ポリシー*: 表で、スナップショット ポリシーの頻度と保持するコピーの数を選択します。複数のスナップショット ポリシーを選択できます。


.. *S3アクセスポイント*：オプションで、S3アクセスポイントを接続して、AWS S3 APIを介してNFSまたはSMB/CIFSボリューム上に存在するFSx for ONTAPファイルシステムデータにアクセスします。ファイルアクセスタイプのみがサポートされます。以下の詳細を入力します（
+
*** *S3 アクセス ポイント名*：S3 アクセス ポイントの名前を入力します。
*** *User*：ボリュームへのアクセス権を持つ既存のユーザーを選択するか、新しいユーザーを作成します。
*** *ユーザー タイプ*：ユーザー タイプとして *UNIX* または *Windows* を選択します。
*** *ネットワーク構成*：*インターネット* または *仮想プライベート クラウド (VPC)* を選択します。選択するネットワークの種類によって、アクセス ポイントがインターネットからアクセスできるか、特定の VPC に制限されるかが決まります。
*** *メタデータを有効にする*：メタデータを有効にすると、S3 アクセス ポイントからアクセスできるすべてのオブジェクトを含む S3 テーブルが作成され、監査、ガバナンス、自動、分析、最適化に使用できるようになります。メタデータを有効にすると追加の AWS コストが発生します。詳細については、link:https://aws.amazon.com/s3/pricing/["Amazon S3 価格設定ドキュメント"^]を参照してください。


.. *S3 アクセス ポイント タグ*：オプションで、最大 50 個のタグを追加できます。




. *作成*を選択します。


.結果
レプリケーション関係は、ターゲットのFSx for ONTAPファイルシステムの*レプリケーション関係*タブに表示されます。

移行のためにレプリケーション関係を作成した場合は、ストレージ VM のデータと構成設定をターゲットの FSx for ONTAP ファイルシステムに移行するために、すべてのボリュームとそれに関連付けられたストレージ VM をカットオーバーする必要があります。



== 移行ユースケースのカットオーバーレプリケーション

移行ユースケースのレプリケーション関係を作成した後、ストレージVMデータと構成設定をターゲットのFSx for ONTAPファイルシステムに移行するには、レプリケーションをカットオーバーする必要があります。カットオーバーレプリケーションは、データとストレージVMの構成設定をソースファイルシステムからターゲットのFSx for ONTAPファイルシステムに永続的に移行します。カットオーバー中に、データが最後に複製されます。カットオーバーが完了すると、システムはソースボリュームを削除します。この操作を元に戻すことはできません。

.開始する前に
開始する前に、これらの要件を確認してください。

* レプリケーションを切り替える前に、ストレージ VM へのクライアントアクセスをすべて停止します。
* レプリケーションを切り替える前に、すべてのソースボリュームがデータを提供していないことを確認してください。
* レプリケーションを切り替える前に、ソースボリュームとターゲットボリューム間でデータが同期されていることを確認します。
* レプリケーション関係に使用する FSx for ONTAP ファイル システムには、関連付けられたリンクが必要です。link:https://docs.netapp.com/us-en/workload-fsx-ontap/create-link.html["既存のリンクを関連付ける方法、または新しいリンクを作成して関連付ける方法を学びます"]。リンクを関連付けたら、この操作に戻ります。


.手順
. NetApp コンソールで、メニューimage:workloads-menu-icon.png["ハンバーガー メニュー アイコンは、storage、eda、ai、databases、vmware、administration などのワークロードに移動するために使用されます。"]を選択し、*ストレージ*を選択します。
. ストレージメニューから、* FSx for ONTAP *を選択します。
. *FSx for ONTAP*から、レプリケートするボリュームを含むファイルシステムを選択します。
. * レプリケーション関係 * タブを選択します。
. レプリケーション関係テーブルで、切り替えるレプリケーション関係を選択し、*レプリケーションの切り替え*を選択します。
. カットオーバーレプリケーションダイアログの情報を確認し、_cut over_ と入力して確定します。


. *カットオーバー* を選択します。


.結果
カットオーバー後、ソースボリュームは削除され、ターゲットボリュームは読み取り / 書き込みになります。カットオーバー後、ターゲットボリュームに対してlink:https://docs.netapp.com/us-en/workload-fsx-ontap/change-tiering-policy.html["階層化ポリシーを変更する"]できます。
